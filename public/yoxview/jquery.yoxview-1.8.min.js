/*!
 * jquery.yoxview v1.8
 * jQuery image gallery viewer
 * http://yoxigen.com/yoxview
 *
 * Copyright (c) 2010 Yossi Kolesnicov
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Date: 25th April, 2010
 * Version : 1.8
 */ 
var yoxviewApi; (function(l){var v=false,p;l.yoxviewUnload=function(){if(yoxviewApi){yoxviewApi.unload();delete yoxviewApi}};l(window).unload(function(){l.yoxviewUnload()});l.fn.yoxviewUnload=function(){jQuery.each(this,function(z,H){l(H).find("a:has(img)").unbind("click.yoxview")});return this};l.fn.yoxview=function(z,H){if(this.length==0)return this;p||(p=typeof _yoxviewPath!="undefined"?_yoxviewPath:getYoxviewPath());this.loadLanguage=function(m,u){var A=this;if(yoxviewLanguages[m])A.loadDataSource(B.dataSource,u); else{yoxviewLanguages[m]={};l.ajax({url:p+"lang/"+m+".js",async:false,dataType:"json",success:function(C){yoxviewLanguages[m]=C;A.loadDataSource(B.dataSource,u)}})}};this.loadDataSource=function(m,u){var A=this;yoxviewDataSources[m]?u(A):l.ajax({url:D.dataFolder+m+".js",async:false,dataType:"script",success:function(C){eval(C);eval("yoxviewDataSources['"+m+"'] = new yoxview_"+m+"();");u(A)},error:function(C,M,W){console.log(C,M,W)}})};var D=l.extend({backgroundColor:"#000",backgroundOpacity:0.8,playDelay:3E3, popupMargin:20,infoBackOpacity:0.5,infoBackColor:"Black",imagesFolder:p+"images/",dataFolder:p+"data/",langFolder:p+"lang/",cacheImagesInBackground:true,displayImageTitleByDefault:true,titleDisplayDuration:2E3,titlePadding:6,buttonsFadeTime:500,loopPlay:true,isRTL:false,lang:"en",titleAttribute:"title",autoPlay:false,showBarsOnOpen:true,showButtonsOnOpen:true,renderButtons:true,renderMenu:true},z),B=l.extend({dataSource:"thumbnails",dataSourceOptions:{}},H);if(v)this.loadLanguage(D.lang,function(m){yoxviewApi.AddViews(m, D,B)});else{v=true;this.loadLanguage(D.lang,function(m){yoxviewApi=new YoxView(m,D,B)})}return this}})(jQuery);function ImageDimensions(l,v){this.Width=l;this.Height=v}var yoxviewLanguages=[],yoxviewDataSources=[]; function YoxView(l,v,p){function z(){if(h){h.parent().remove();x=y=N=E=X=I=h=undefined;J=q=0}fa()}function H(a){a=d(a).data("yoxview");if(!s||ga!=a.viewIndex){s=a.images;i=s.length;ga=a.viewIndex;var b=false;if(a.options&&!ha(c,a.options)){c=a.options;b=true}else if(!a.options&&!ha(c,ia)){c=ia;b=true}else if(I&&i==1||h&&!I&&i>0)b=true;b&&z()}}function D(a,b,f,g){a=d(a);a.data("yoxview",{viewIndex:b});if(g.images!=null){g=g.images;O=d(a.find("a:has(img)")[0]);O.data("yoxview",{viewIndex:b}).bind("click.yoxview", function(){j.openGallery(d(this).data("yoxview").viewIndex);return false})}else g=yoxviewDataSources[g.dataSource].getImagesData(a,f,g);a.data("yoxview").images=g;if(f!=c)a.data("yoxview").options=f}function B(a){var b=d(P[ga]);O=b[0].tagName=="A"?b:b.yoxthumbs("thumbnails").eq(q);if(b=O.children("img:first")){a&&E&&E.attr("src",b.attr("src"));ja=b.offset();n={width:b.width(),height:b.height(),top:ja.top-d(window).scrollTop(),left:ja.left}}}function m(a){a.css("opacity")==0&&a.stop().animate({opacity:0}, c.buttonsFadeTime,A(a))}function u(a){a.stop().fadeIn(c.buttonsFadeTime).oneTime(1E3,function(){d(this).stop().fadeOut(c.buttonsFadeTime)})}function A(a){d(a).stop().animate({opacity:0.5},c.buttonsFadeTime)}function C(a){if(j&&j.isOpen){var b=j[Ba[Ca[a.keyCode]]];if(b){a.preventDefault();b.apply(j);return false}return true}return true}function M(a,b,f,g){var e=d("<a>",{href:"#",click:function(){return j.clickBtn(f,g)}});d("<span>"+b+"</span>").css("opacity","0").appendTo(e);e.append(sa(a,b,"18","16")).hover(function(){d(this).stop().animate({top:"8px"}, "fast").find("span").stop().animate({opacity:1},"fast")},function(){d(this).stop().animate({top:"0"},"fast").find("span").stop().animate({opacity:0},"fast")});return e}function W(a,b,f){var g=new Image;g.src=c.imagesFolder+b+".png";f=d("<a>",{css:{background:"url("+g.src+") no-repeat "+b+" center",opacity:"0",outline:"0"},className:"yoxview_ctlBtn",title:f,href:"#",click:function(){this.blur();return j.clickBtn(a,true)}});f.css(b,"0");return f}function fa(){r=yoxviewLanguages[c.lang];h=d("<div>", {id:"yoxview"});h.appendTo(d(parent.document.body));y=d("<div>",{className:"yoxview_imgPanel",css:{"z-index":"2"}});x=d("<div>",{className:"yoxview_imgPanel",css:{"z-index":"1",display:"none"}});E=d("<img />",{className:"yoxview_fadeImg",css:{display:"block",width:"100%",height:"100%"}});N=d("<img />",{className:"yoxview_fadeImg",css:{display:"block",width:"100%",height:"100%"}});y.data("yoxviewPanel",{image:E}).append(E).appendTo(h);x.data("yoxviewPanel",{image:N});x.append(N).appendTo(h);var a= i==1;if(c.renderMenu!==false){var b=d("<div>",{id:"yoxview_popupMenuPanel",className:"yoxview_popupBarPanel yoxview_top",css:{opacity:"0"}}),f=d("<div>",{id:"yoxview_popupMenu",className:"yoxview_popupBar",css:{opacity:"0.8"}});(new Image).src=c.imagesFolder+"menu_back.png";var g=M("help.png",r.Help,j.help,false),e=M("play.png",r.Slideshow,j.play,false);f.append(M("close.png",r.Close,j.close,true),g,e);if(a){e.css("display","none");g.css("display","none");f.css("background-position","95px 0")}f.find("a:last-child").attr("class", "last");b.append(f).appendTo(h)}if(c.renderButtons!==false&&!a){I=W(j.prev,c.isRTL?"right":"left",r.PrevImage);I.appendTo(h);X=W(j.next,c.isRTL?"left":"right",r.NextImage);X.appendTo(h)}K=h.find(".yoxview_ctlBtn");Y=d("<div>",{id:"yoxview_ajaxLoader",className:"yoxview_notification",css:{display:"none"}});Y.append(sa("popup_ajax_loader.gif",r.Loading,"32","32")).appendTo(h);jQuery.each(["play","pause","first","last"],function(){var o=d("<img />",{className:"yoxview_notification",alt:this,src:c.imagesFolder+ "popup_"+this+".png",css:{display:"none"}});o.appendTo(h);Q[this]=o});F=d("<div>",{id:"yoxview_helpPanel",href:"#",title:r.CloseHelp,css:{background:"url("+c.imagesFolder+"help_panel.png) no-repeat center top",direction:r.Direction,opacity:"0"},click:function(){return j.clickBtn(j.help,false)}});a=document.createElement("h1");a.innerHTML=r.Help.toUpperCase();b=document.createElement("p");b.innerHTML=r.HelpText;f=document.createElement("span");f.id="yoxview_closeHelp";f.innerHTML=r.CloseHelp;F.append(a).append(b).append(f).appendTo(h); t=d("<div>",{id:"yoxview_popupInfo",className:"yoxview_popupBarPanel yoxview_bottom"});ka=d("<div>",{className:"yoxview_popupBar yoxview_bottom",css:{background:c.infoBackColor,opacity:c.infoBackOpacity,"z-index":"1",padding:c.titlePadding+"px 0","min-height":la}});ka.appendTo(t);Z=d("<h1>",{className:"yoxview_popupBar",css:{"z-index":"2",bottom:c.titlePadding,opacity:"1"}});Z.appendTo(t);ma=d("<span>",{css:{opacity:"1"}});ma.appendTo(t);h.append(t);a=d("<div>",{id:"yoxview_popupWrap",css:{position:"fixed", top:"0",left:"0",width:"100%",height:"100%",display:"none","z-index":"100"}});h.wrap(a);na=d("<div>",{css:{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",background:c.backgroundColor,"z-index":"1",opacity:c.backgroundOpacity},click:function(){return j.clickBtn(j.close,true)}}).appendTo(h.parent());c.buttonsFadeTime!=0&&K.hover(function(){d(this).stop().animate({opacity:0.5},c.buttonsFadeTime)},function(){d(this).stop().animate({opacity:0},c.buttonsFadeTime)});R=h.children(".yoxview_popupBarPanel"); R.hover(function(){var o=d(this);o.data("disabled")||o.stop().animate({opacity:1},c.buttonsFadeTime)},function(){d(this).data("disabled")||d(this).stop().animate({opacity:0},c.buttonsFadeTime)})}function G(a){if(a==i)a=0;var b=s[a].media;if(b.loaded){b=a+1;if(b==i)b=0;if(s[b].media.loaded){b=a-1;if(b<0)b=i-1;s[b].media.loaded||G(b)}else G(b)}else{J=a;if(!b.type||b.type==="image")ta.src=b.src;else ua(b,function(){G(J+1)})}}function sa(a,b,f,g){var e=document.createElement("img");d(e).attr({src:c.imagesFolder+ a,alt:b,width:f,height:g});return e}function Da(){oa=true;Y.stop().stopTime().oneTime(c.buttonsFadeTime,function(){d(this).stop().fadeIn(c.buttonsFadeTime)})}function Ea(){oa=false;Y.stop().stopTime().fadeOut(c.buttonsFadeTime)}function va(){w||Da();Fa(S.media)}function wa(a,b,f,g){var e=new ImageDimensions(a,b);if(a>f){e.Height=Math.round(f/a*b);e.Width=f}if(e.Height>g){e.Width=Math.round(g/e.Height*e.Width);e.Height=g}return e}function pa(a,b,f,g,e){h.stop().animate({width:a,height:b,top:f,left:g}, "slow",e)}function $(){if(i!=1){w=true;if(q<i-1)h.oneTime(c.playDelay,"play",function(){j.next()});else c.loopPlay?h.oneTime(c.playDelay,"play",function(){j.select(0,null)}):T()}}function T(){h.stopTime("play");w=false}function xa(){var a=d(parent.window).width(),b=d(parent.window).height();return{height:b,width:a,usableHeight:b-c.popupMargin*2,usableWidth:a-c.popupMargin*2}}function ya(){var a=Z.outerHeight();if(a<la)a=la;ka.animate({height:a},"fast")}function aa(a){var b;if(y.css("z-index")==1){k= y;b=E;ba=x}else{k=x;b=N;ba=y}k.data("maxSize",{width:a.width,height:a.height});var f=xa(),g=wa(a.width,a.height,f.usableWidth,f.usableHeight);Z.html(a.title);i>1&&ma.html(q+1+"/"+i);var e=k.data("yoxviewPanel");if(!a.type||a.type==="image"){b.attr({src:a.src,title:a.title,alt:a.alt});K.css({height:"100%",width:"50%",top:"0"});if(k.isMedia){e.media.remove();e.media=undefined;e.image.show();k.isMedia=false}t.data("disabled",false)}else{if(e.media)e.media.show();else{e.media=d("<div>",{className:"yoxview_mediaPanel"}); e.image.hide();k.append(e.media)}e.media.html(a.html);K.css({width:ca.width,height:ca.height,top:g.Height/2-ca.height/2});if(!k.isMedia){e.image.hide();k.isMedia=true}t.css("display","none").data("disabled",true)}da?k.animate({width:g.Width,height:g.Height},"slow"):k.css({width:g.Width+"px",height:g.Height+"px"});b=Math.round((f.height-g.Height)/2);f=Math.round((f.width-g.Width)/2);oa&&Ea();L=true;pa(g.Width,g.Height,b,f,function(){if(da){R.css("display","block");c.showButtonsOnOpen&&K.animate({opacity:0.5}, 1500).oneTime(1700,function(){c.buttonsFadeTime!=0&&d(this).animate({opacity:0},1500)});c.showBarsOnOpen&&R.animate({opacity:1},1500).oneTime(1700,function(){d(this).animate({opacity:0},1500)});ya();c.autoPlay&&j.play();c.onOpen&&c.onOpen();if(ea){ea();ea=undefined}da=false}L=false});k.css("z-index","2");ba.css("z-index","1");k.fadeIn("slow",function(){ba.css("display","none");if((!a.type||a.type==="image")&&a.title&&a.title!=""){t.css({display:"block"});ya();c.displayImageTitleByDefault&&t.stop().stopTime().animate({opacity:1}, 500,function(){d(this).oneTime(c.titleDisplayDuration,function(){d(this).stop().animate({opacity:0},500)})})}else t.css("display")!="none"&&t.fadeOut(c.buttonsFadeTime);if(i>1){q<i-1&&c.cacheImagesInBackground&&G(q+1);w&&$()}})}function Fa(a){if(a.loaded)aa(S.media);else if(!a.type||a.type==="image")za.src=a.src;else ua(a,function(b){aa(b)},function(b){qa("Error getting data from:<br /><span class='errorUrl'>"+b.data.url+"</span>")})}function ua(a,b,f){if(!a.type||a.type!=="image"){ra||(ra=new yoxviewMedia); ra.loadMedia(a.provider,a.url,c.videoSize,function(g){d.extend(a,g,{loaded:true});b&&b(a)},f)}}function qa(a){aa({html:"<span class='yoxview_error'>"+a+"</span>",width:500,height:300,type:"error",title:""})}function ha(a,b){function f(Ga){var Aa=0;for(var Ha in Ga)Ha!=null&&Aa++;return Aa}if(f(a)!=f(b))return false;for(var g in a){var e=a[g],o=b[g];if(typeof e!=typeof o)return false;if(e&&e.length&&e[0]!==undefined&&e[0].tagName){if(!o||o.length!=e.length||!o[0].tagName||o[0].tagName!=e[0].tagName)return false}else if(typeof e== "function"||typeof e=="object"){e=ha(e,o);if(!e)return e}else if(e!=o)return false}return true}var j=this,ia=v,c=ia,r={},P=[],ga=0,s,i=0,h,q=0,S,O,ja,n,da=true,E,N,y,x,I,X,Y,F,t,Z,la=28-2*c.titlePadding,ka,R,K,na,ma,w=false,U=false,Q=[],za=new Image,ta=new Image,J=0,L=this.isOpen=false,V,oa=false,ea,ra,ca={width:100,height:100},d=jQuery,Ca={40:"DOWN",35:"END",13:"ENTER",36:"HOME",37:"LEFT",39:"RIGHT",32:"SPACE",38:"UP",72:"h",27:"ESCAPE"},Ba={RIGHT:c.isRTL?"prev":"next",DOWN:"next",UP:"prev",LEFT:c.isRTL? "next":"prev",ENTER:"play",HOME:"first",END:"last",SPACE:"next",h:"help",ESCAPE:"close"};this.AddViews=function(a,b,f){var g=V!=undefined;jQuery.each(a,function(){D(this,P.length,b,f);P.push(this);if(!V){var e=d(this).data("yoxview").images;if(e&&e.length!=0)V=this}});if(!g&&V){H(V);fa();b.cacheImagesInBackground&&i!=0&&G(0);g=true}};this.SetImages=function(a){s=a;i=s.length};this.openGallery=function(a,b,f){if(typeof a=="function"){f=a;a=b=0}else if(typeof b=="function"){f=b;b=0}a=a||0;b=b||0;H(P[a]); !h&&i!=0&&fa();c.cacheImagesInBackground&&G(b);this.selectImage(b);h.parent().stop().fadeIn("slow");if(f)ea=f;return false};this.selectImage=function(a){S=s[a];q=a;B(true);O.blur();y.css({"z-index":"1",width:n.width,height:n.height});x.css({display:"none","z-index":"2"});da=true;h.css({width:n.width,height:n.height,top:n.top,left:n.left});this.select(a);this.isOpen=true};this.refresh=function(){(U=w)&&T();va(q);U&&$()};this.select=function(a,b){if(typeof b==="number")b=undefined;if(!L){if(a<0)a=i- 1;else if(a==i)a=0;!w&&b&&m(b);S=s[a];q=a;va(q);c.onSelect&&c.onSelect(a)}};this.prev=function(){this.select(q-1,I);return false};this.next=function(){this.select(q+1,X);return false};this.first=function(){u(Q.first);this.select(0);return false};this.last=function(){u(Q.last);this.select(i-1);return false};this.play=function(){if(i!=1)if(w){u(Q.pause);T()}else{u(Q.play);$()}};this.close=function(){this.closeHelp();B(false);pa(n.width,n.height,n.top,n.left);na.animate({opacity:0},"slow");k.animate({width:n.width, height:n.height,opacity:0},"slow",function(){h.parent().stop().fadeOut("slow",function(){k.css("opacity",1);na.css("opacity",c.backgroundOpacity)})});R.css("display","none");c.onClose&&c.onClose();L=this.isOpen=false};this.help=function(){if(this.isOpen)F.css("display")=="none"?F.css("display","block").stop().animate({opacity:0.8},c.buttonsFadeTime):this.closeHelp()};this.closeHelp=function(){F.css("display")!="none"&&F.stop().animate({opacity:0},c.buttonsFadeTime,function(){F.css("display","none")})}; this.clickBtn=function(a,b){b&&w&&T();a.call(this);return false};this.AddViews(l,c,p);d(document).delegate("*","keydown",function(a){C(a)});d(window).bind("resize.yoxview",function(){j.isOpen&&j.resize()});d(ta).load(function(){d.extend(s[J].media,{width:this.width,height:this.height,loaded:true});J<i-1&&G(J+1)});var k=y,ba=x;this.resize=function(){if(w){U=true;T()}var a=xa(),b=k.data("maxSize");if(b&&b){b=wa(b.width,b.height,a.usableWidth,a.usableHeight);k.css({width:"100%",height:"100%"});var f= Math.round((a.height-b.Height)/2);a=Math.round((a.width-b.Width)/2);L=true;k.isMedia&&K.animate({top:b.Height/2-ca.height/2},"slow");pa(b.Width,b.Height,f,a,function(){var g=h.width(),e=h.height();k.css({width:g+"px",height:e+"px"});L=false;if(U){$();U=false}})}};d(za).load(function(){this.width==0?qa("Image error"):aa(d.extend({},S.media,{width:this.width,height:this.height}))}).error(function(){qa("Image not found:<br /><span class='errorUrl'>"+this.src+"</span>")});this.unload=function(){jQuery.each(P, function(a,b){d(b).find("a:has(img)").unbind("click.yoxview")});if(h){h.parent().remove();h=undefined}}}function getYoxviewPath(){for(var l=document.getElementsByTagName("script"),v=/(.*)jquery.yoxview.*/i,p=0;p<l.length;p++){var z=l[p].src;if(z.match(v))return z.match(v)[1]}return null};